<!-- home.html -->
{% extends "base.html" %} {% block content %} {% load static %}

<form class="form-inline" id="q_udis_dollar">
  <div class="form-group mx-sm-3 mb-2">
    <input
      class="form-control"
      name="start_date"
      id="start_datepicker"
      placeholder="Fecha Inicial"
    />
  </div>
  <div class="form-group mx-sm-3 mb-2">
    <input
      class="form-control"
      name="end_date"
      id="end_datepicker"
      placeholder="Fecha Final"
    />
  </div>
  <button type="submit" class="btn btn-success mx-sm-3 mb-2">Consultar</button>
</form>

<div id="root"></div>
<script>
  $('#start_datepicker').datepicker({
    format: 'dd/mm/yyyy',
    uiLibrary: 'bootstrap4',
    autoclose: true,
  });
  $('#end_datepicker').datepicker({
    format: 'dd/mm/yyyy',
    uiLibrary: 'bootstrap4',
    autoclose: true,
  });
</script>
<script>
  function renderData(data) {
    // data = data.map((item) => item.titulo);
    console.log(data.response);
  }

  const crf_token = ('; ' + document.cookie)
    .split('; csrftoken=')
    .pop()
    .split(';')
    .shift();

  const udis_dollar_form = document.getElementById('q_udis_dollar');

  udis_dollar_form.addEventListener('submit', (event) => {
    event.preventDefault();
    const start_date = document.getElementById('start_datepicker');
    const end_date = document.getElementById('end_datepicker');
    const formData = new FormData();

    formData.append('start_date', start_date.value);
    formData.append('end_date', end_date.value);

    query_data = {
      method: 'POST',
      headers: {
        'X-CSRFToken': crf_token,
        Accept: 'application/json',
      },
      body: formData,
    };

    fetch('query_udis_dollar', query_data)
      .then((response) => response.json())
      .then((data) => {
        // console.log(data);
        renderData(data);
      })
      .catch((error) => alert('Error al Consultar'));
  });
</script>

{% endblock content %}
<script src="{% static 'js/main.js' %}"></script>
